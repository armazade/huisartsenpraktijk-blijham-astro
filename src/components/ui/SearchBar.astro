---
---

<div class="relative" id="search-container">
  <form action="/zoeken" method="get" class="relative">
    <label for="search-input" class="sr-only">Zoeken op de website</label>
    <div class="relative">
      <input
        type="search"
        id="search-input"
        name="q"
        placeholder="Zoeken..."
        class="search-input w-full sm:w-72 pl-10 pr-4 py-2.5 text-base bg-[var(--color-bg-soft)] border-2 border-transparent rounded-xl focus:border-[var(--color-blue)] focus:bg-white focus:outline-none transition-all placeholder:text-[var(--color-navy-light)]"
        autocomplete="off"
        aria-describedby="search-hint"
        aria-autocomplete="list"
        aria-controls="search-results"
      />
    </div>
    <span id="search-hint" class="sr-only">
      Typ minimaal 2 karakters om te zoeken. Gebruik de pijltjestoetsen om door resultaten te navigeren.
    </span>
  </form>

  <!-- Search results dropdown -->
  <div
    id="search-results"
    class="absolute top-full left-0 right-0 mt-2 bg-white border border-[var(--color-navy-lighter)] rounded-xl shadow-lg z-50 hidden overflow-hidden"
    role="listbox"
    aria-label="Zoekresultaten"
  >
    <ul class="py-2 max-h-80 overflow-y-auto" id="search-results-list" role="group">
      <!-- Results will be inserted here by JavaScript -->
    </ul>
    <div id="search-no-results" class="hidden px-4 py-4 text-[var(--color-navy-light)] text-center">
      <svg class="w-8 h-8 mx-auto mb-2 opacity-50" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
      </svg>
      Geen resultaten gevonden
    </div>
  </div>
</div>

<style>
  /* Override global min-height for search input */
  .search-input {
    min-height: auto !important;
    height: auto !important;
  }
</style>

<script>
  interface SearchPage {
    title: string;
    href: string;
    content: string;
  }

  // Search data - pages and their content
  const searchablePages: SearchPage[] = [
    { title: 'Home', href: '/', content: 'welkom huisartsenpraktijk blijham' },
    { title: 'Medewerkers', href: '/team', content: 'team medewerkers huisarts doktersassistente poh' },
    { title: 'Doktersassistente', href: '/doktersassistente', content: 'doktersassistente assistente telefonisch afspraak' },
    { title: 'POH Somatiek', href: '/praktijkondersteuner-somatiek', content: 'praktijkondersteuner somatiek diabetes copd astma hart chronisch' },
    { title: 'POH GGZ', href: '/praktijkondersteuner-ggz', content: 'praktijkondersteuner ggz geestelijke gezondheid psychisch angst depressie' },
    { title: 'Apotheek', href: '/apotheek', content: 'apotheek medicijnen medicatie recept' },
    { title: 'Afwezigheid en vakanties', href: '/afwezigheid-en-vakanties', content: 'afwezigheid vakantie waarneming gesloten' },
    { title: 'Routebeschrijving', href: '/routebeschrijving', content: 'route adres bereikbaarheid kaart parkeren' },
    { title: 'Klachtenregeling', href: '/klachtenregeling', content: 'klacht klachten regeling ontevreden' },
    { title: 'Afspraak maken', href: '/afspraak-maken', content: 'afspraak consult spreekuur bellen' },
    { title: 'Nieuws', href: '/nieuws', content: 'nieuws berichten actualiteit' },
    { title: 'Thuisarts nieuws', href: '/thuisarts-nieuws', content: 'thuisarts gezondheid informatie' },
    { title: 'Geneesmiddelen mee op reis', href: '/geneesmiddelen-mee-op-reis', content: 'reis reizen vakantie medicijnen buitenland' },
    { title: 'Herhaalrecepten', href: '/herhaalrecepten', content: 'herhaalrecept recept medicijnen aanvragen bestellen' },
    { title: 'Privacy', href: '/privacy', content: 'privacy gegevens bescherming avg' },
    { title: 'Voorwaarden', href: '/voorwaarden', content: 'voorwaarden algemeen' },
  ];

  const searchInput = document.getElementById('search-input') as HTMLInputElement;
  const searchResults = document.getElementById('search-results');
  const searchResultsList = document.getElementById('search-results-list');
  const searchNoResults = document.getElementById('search-no-results');

  let selectedIndex = -1;

  function performSearch(query: string): SearchPage[] {
    const searchTerm = query.toLowerCase().trim();
    if (searchTerm.length < 2) return [];

    return searchablePages.filter(page =>
      page.title.toLowerCase().includes(searchTerm) ||
      page.content.toLowerCase().includes(searchTerm)
    );
  }

  function renderResults(results: SearchPage[]): void {
    if (!searchResultsList || !searchNoResults || !searchResults) return;

    selectedIndex = -1;

    if (results.length === 0) {
      searchResultsList.innerHTML = '';
      searchNoResults.classList.remove('hidden');
      searchResults.classList.remove('hidden');
      return;
    }

    searchNoResults.classList.add('hidden');
    searchResultsList.innerHTML = results.map((page, index) => `
      <li role="option" id="search-option-${index}" aria-selected="false">
        <a href="${page.href}" class="flex items-center gap-3 px-4 py-3 hover:bg-[var(--color-purple-light)] hover:text-[var(--color-purple)] transition-colors text-[var(--color-navy)]" tabindex="-1">
          <svg class="w-4 h-4 opacity-50" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
          </svg>
          ${page.title}
        </a>
      </li>
    `).join('');
    searchResults.classList.remove('hidden');
  }

  function updateSelection(newIndex: number, results: SearchPage[]): void {
    const items = searchResultsList?.querySelectorAll('li');
    if (!items) return;

    items.forEach((item, i) => {
      const link = item.querySelector('a');
      if (i === newIndex) {
        item.setAttribute('aria-selected', 'true');
        link?.classList.add('bg-[var(--color-purple-light)]', 'text-[var(--color-purple)]');
      } else {
        item.setAttribute('aria-selected', 'false');
        link?.classList.remove('bg-[var(--color-purple-light)]', 'text-[var(--color-purple)]');
      }
    });

    selectedIndex = newIndex;
    searchInput?.setAttribute('aria-activedescendant', newIndex >= 0 ? `search-option-${newIndex}` : '');
  }

  searchInput?.addEventListener('input', (e) => {
    const target = e.target as HTMLInputElement;
    const query = target.value;

    if (query.length < 2) {
      searchResults?.classList.add('hidden');
      return;
    }

    const results = performSearch(query);
    renderResults(results);
  });

  // Keyboard navigation
  searchInput?.addEventListener('keydown', (e) => {
    const results = performSearch(searchInput.value);

    if (e.key === 'ArrowDown') {
      e.preventDefault();
      const newIndex = selectedIndex < results.length - 1 ? selectedIndex + 1 : 0;
      updateSelection(newIndex, results);
    } else if (e.key === 'ArrowUp') {
      e.preventDefault();
      const newIndex = selectedIndex > 0 ? selectedIndex - 1 : results.length - 1;
      updateSelection(newIndex, results);
    } else if (e.key === 'Enter' && selectedIndex >= 0) {
      e.preventDefault();
      const selectedLink = searchResultsList?.querySelector(`#search-option-${selectedIndex} a`) as HTMLAnchorElement;
      if (selectedLink) {
        window.location.href = selectedLink.href;
      }
    } else if (e.key === 'Escape') {
      searchResults?.classList.add('hidden');
      searchInput.blur();
    }
  });

  // Close search results when clicking outside
  document.addEventListener('click', (e) => {
    const target = e.target as HTMLElement;
    const container = document.getElementById('search-container');
    if (container && !container.contains(target)) {
      searchResults?.classList.add('hidden');
    }
  });

  // Focus management
  searchInput?.addEventListener('focus', () => {
    if (searchInput.value.length >= 2) {
      const results = performSearch(searchInput.value);
      renderResults(results);
    }
  });
</script>
