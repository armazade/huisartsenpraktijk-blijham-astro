---
import FormProgress from './FormProgress.astro';
---

<div class="max-w-2xl mx-auto">
  <FormProgress currentStep={1} totalSteps={4} />

  <form id="prescription-form" class="space-y-8" novalidate>
    <!-- Step 1: Personal Details -->
    <div id="step-1" class="form-step">
      <h2 class="text-2xl font-bold text-gray-900 mb-6">Stap 1: Persoonsgegevens</h2>

      <div class="space-y-4">
        <div>
          <label for="voorletters" class="block font-medium text-gray-700 mb-1">
            Voorletters
          </label>
          <input
            type="text"
            id="voorletters"
            name="voorletters"
            placeholder="Bijv. J.H."
            class="w-full"
          />
        </div>

        <div>
          <label for="voornaam" class="block font-medium text-gray-700 mb-1">
            Voornaam
          </label>
          <input
            type="text"
            id="voornaam"
            name="voornaam"
            placeholder="Uw voornaam"
            class="w-full"
          />
        </div>

        <div>
          <label for="tussenvoegsel" class="block font-medium text-gray-700 mb-1">
            Tussenvoegsel
          </label>
          <input
            type="text"
            id="tussenvoegsel"
            name="tussenvoegsel"
            placeholder="Bijv. van, de"
            class="w-full"
          />
        </div>

        <div>
          <label for="achternaam" class="block font-medium text-gray-700 mb-1">
            Achternaam <span class="text-red-600">*</span>
          </label>
          <input
            type="text"
            id="achternaam"
            name="achternaam"
            required
            placeholder="Uw achternaam"
            class="w-full"
          />
          <p class="text-sm text-red-600 mt-1 hidden" id="achternaam-error">
            Vul uw achternaam in
          </p>
        </div>

        <div>
          <label for="geboorteplaats" class="block font-medium text-gray-700 mb-1">
            Geboorteplaats
          </label>
          <input
            type="text"
            id="geboorteplaats"
            name="geboorteplaats"
            placeholder="Uw geboorteplaats"
            class="w-full"
          />
        </div>

        <div>
          <fieldset>
            <legend class="block font-medium text-gray-700 mb-1">
              Geboortedatum <span class="text-red-600">*</span>
            </legend>
            <div class="grid grid-cols-3 gap-2">
              <div>
                <label for="geboortedag" class="sr-only">Dag</label>
                <select id="geboortedag" name="geboortedag" required class="w-full">
                  <option value="">Dag</option>
                  {Array.from({ length: 31 }, (_, i) => i + 1).map((day) => (
                    <option value={String(day).padStart(2, '0')}>
                      {day}
                    </option>
                  ))}
                </select>
              </div>
              <div>
                <label for="geboortemaand" class="sr-only">Maand</label>
                <select id="geboortemaand" name="geboortemaand" required class="w-full">
                  <option value="">Maand</option>
                  <option value="01">Januari</option>
                  <option value="02">Februari</option>
                  <option value="03">Maart</option>
                  <option value="04">April</option>
                  <option value="05">Mei</option>
                  <option value="06">Juni</option>
                  <option value="07">Juli</option>
                  <option value="08">Augustus</option>
                  <option value="09">September</option>
                  <option value="10">Oktober</option>
                  <option value="11">November</option>
                  <option value="12">December</option>
                </select>
              </div>
              <div>
                <label for="geboortejaar" class="sr-only">Jaar</label>
                <select id="geboortejaar" name="geboortejaar" required class="w-full">
                  <option value="">Jaar</option>
                  {Array.from({ length: 120 }, (_, i) => new Date().getFullYear() - i).map((year) => (
                    <option value={year}>
                      {year}
                    </option>
                  ))}
                </select>
              </div>
            </div>
            <p class="text-sm text-red-600 mt-1 hidden" id="geboortedatum-error">
              Vul uw geboortedatum in
            </p>
          </fieldset>
        </div>

        <div>
          <fieldset>
            <legend class="block font-medium text-gray-700 mb-1">
              Geslacht <span class="text-red-600">*</span>
            </legend>
            <div class="flex gap-4">
              <label class="flex items-center gap-2 cursor-pointer">
                <input type="radio" name="geslacht" value="man" required class="w-5 h-5" />
                <span>Man</span>
              </label>
              <label class="flex items-center gap-2 cursor-pointer">
                <input type="radio" name="geslacht" value="vrouw" required class="w-5 h-5" />
                <span>Vrouw</span>
              </label>
              <label class="flex items-center gap-2 cursor-pointer">
                <input type="radio" name="geslacht" value="anders" required class="w-5 h-5" />
                <span>Anders</span>
              </label>
            </div>
            <p class="text-sm text-red-600 mt-1 hidden" id="geslacht-error">
              Selecteer uw geslacht
            </p>
          </fieldset>
        </div>
      </div>
    </div>

    <!-- Step 2: Address Details -->
    <div id="step-2" class="form-step hidden">
      <h2 class="text-2xl font-bold text-gray-900 mb-6">Stap 2: Adresgegevens</h2>

      <div class="space-y-4">
        <div>
          <label for="straatnaam" class="block font-medium text-gray-700 mb-1">
            Straatnaam
          </label>
          <input
            type="text"
            id="straatnaam"
            name="straatnaam"
            placeholder="Uw straatnaam"
            class="w-full"
          />
        </div>

        <div>
          <label for="huisnummer" class="block font-medium text-gray-700 mb-1">
            Huisnummer
          </label>
          <input
            type="text"
            id="huisnummer"
            name="huisnummer"
            placeholder="Bijv. 12a"
            class="w-full"
          />
        </div>

        <div>
          <label for="postcode" class="block font-medium text-gray-700 mb-1">
            Postcode
          </label>
          <input
            type="text"
            id="postcode"
            name="postcode"
            placeholder="1234 AB"
            pattern="[0-9]{4}\s?[A-Za-z]{2}"
            class="w-full"
          />
        </div>

        <div>
          <label for="woonplaats" class="block font-medium text-gray-700 mb-1">
            Woonplaats
          </label>
          <input
            type="text"
            id="woonplaats"
            name="woonplaats"
            placeholder="Uw woonplaats"
            class="w-full"
          />
        </div>

        <div>
          <label for="mobiel" class="block font-medium text-gray-700 mb-1">
            Mobiel nummer
          </label>
          <input
            type="tel"
            id="mobiel"
            name="mobiel"
            placeholder="06-12345678"
            class="w-full"
          />
        </div>

        <div>
          <label for="telefoon" class="block font-medium text-gray-700 mb-1">
            Telefoonnummer (vast)
          </label>
          <input
            type="tel"
            id="telefoon"
            name="telefoon"
            placeholder="0123-456789"
            class="w-full"
          />
        </div>

        <div>
          <label for="email" class="block font-medium text-gray-700 mb-1">
            E-mailadres <span class="text-red-600">*</span>
          </label>
          <input
            type="email"
            id="email"
            name="email"
            required
            placeholder="uw.email@voorbeeld.nl"
            class="w-full"
          />
          <p class="text-sm text-red-600 mt-1 hidden" id="email-error">
            Vul een geldig e-mailadres in
          </p>
        </div>
      </div>
    </div>

    <!-- Step 3: Medications -->
    <div id="step-3" class="form-step hidden">
      <h2 class="text-2xl font-bold text-gray-900 mb-6">Stap 3: Medicijnen</h2>

      <div id="medications-container" class="space-y-6">
        <div class="medication-item border border-gray-200 rounded-lg p-4">
          <h3 class="font-medium text-gray-900 mb-4">Medicijn 1</h3>
          <div class="space-y-4">
            <div>
              <label class="block font-medium text-gray-700 mb-1">
                Naam medicijn <span class="text-red-600">*</span>
              </label>
              <input
                type="text"
                name="medicijn_naam[]"
                required
                placeholder="Naam van het medicijn"
                class="w-full medication-name"
              />
            </div>
            <div>
              <label class="block font-medium text-gray-700 mb-1">
                Gebruik per dag <span class="text-red-600">*</span>
              </label>
              <input
                type="text"
                name="medicijn_gebruik[]"
                required
                placeholder="Bijv. 2x daags"
                class="w-full medication-usage"
              />
            </div>
            <div>
              <label class="block font-medium text-gray-700 mb-1">
                Sterkte <span class="text-red-600">*</span>
              </label>
              <input
                type="text"
                name="medicijn_sterkte[]"
                required
                placeholder="Bijv. 10mg"
                class="w-full medication-strength"
              />
            </div>
          </div>
        </div>
      </div>

      <button
        type="button"
        id="add-medication"
        class="mt-4 inline-flex items-center gap-2 px-4 py-2 border-2 border-dashed border-gray-300 rounded-lg text-gray-600 hover:border-primary-500 hover:text-primary-600 transition-colors"
      >
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
        </svg>
        Medicijn toevoegen
      </button>

      <div class="mt-8 space-y-4">
        <div>
          <label for="apotheek" class="block font-medium text-gray-700 mb-1">
            Naam apotheek <span class="text-red-600">*</span>
          </label>
          <input
            type="text"
            id="apotheek"
            name="apotheek"
            required
            placeholder="Naam van uw apotheek"
            class="w-full"
          />
          <p class="text-sm text-red-600 mt-1 hidden" id="apotheek-error">
            Vul de naam van uw apotheek in
          </p>
        </div>

        <div>
          <label for="opmerkingen" class="block font-medium text-gray-700 mb-1">
            Opmerkingen
          </label>
          <textarea
            id="opmerkingen"
            name="opmerkingen"
            rows="4"
            placeholder="Eventuele opmerkingen..."
            class="w-full"
          ></textarea>
        </div>

        <div>
          <fieldset>
            <legend class="block font-medium text-gray-700 mb-1">
              Bezorgen? <span class="text-red-600">*</span>
            </legend>
            <div class="flex gap-4">
              <label class="flex items-center gap-2 cursor-pointer">
                <input type="radio" name="bezorgen" value="ja" required class="w-5 h-5" />
                <span>Ja</span>
              </label>
              <label class="flex items-center gap-2 cursor-pointer">
                <input type="radio" name="bezorgen" value="nee" required class="w-5 h-5" />
                <span>Nee</span>
              </label>
            </div>
            <p class="text-sm text-red-600 mt-1 hidden" id="bezorgen-error">
              Geef aan of u het medicijn wilt laten bezorgen
            </p>
          </fieldset>
        </div>
      </div>
    </div>

    <!-- Step 4: Summary -->
    <div id="step-4" class="form-step hidden">
      <h2 class="text-2xl font-bold text-gray-900 mb-6">Stap 4: Samenvatting</h2>

      <div class="space-y-6">
        <div class="bg-gray-50 rounded-lg p-6">
          <div class="flex items-center justify-between mb-4">
            <h3 class="text-lg font-semibold text-gray-900">Persoonsgegevens</h3>
            <button type="button" class="edit-step text-primary-600 hover:underline" data-step="1">
              Wijzigen
            </button>
          </div>
          <dl id="summary-personal" class="space-y-2 text-gray-700">
            <!-- Filled by JavaScript -->
          </dl>
        </div>

        <div class="bg-gray-50 rounded-lg p-6">
          <div class="flex items-center justify-between mb-4">
            <h3 class="text-lg font-semibold text-gray-900">Adresgegevens</h3>
            <button type="button" class="edit-step text-primary-600 hover:underline" data-step="2">
              Wijzigen
            </button>
          </div>
          <dl id="summary-address" class="space-y-2 text-gray-700">
            <!-- Filled by JavaScript -->
          </dl>
        </div>

        <div class="bg-gray-50 rounded-lg p-6">
          <div class="flex items-center justify-between mb-4">
            <h3 class="text-lg font-semibold text-gray-900">Medicijnen</h3>
            <button type="button" class="edit-step text-primary-600 hover:underline" data-step="3">
              Wijzigen
            </button>
          </div>
          <dl id="summary-medications" class="space-y-2 text-gray-700">
            <!-- Filled by JavaScript -->
          </dl>
        </div>

        <div class="space-y-4">
          <label class="flex items-start gap-3 cursor-pointer">
            <input type="checkbox" id="privacy-consent" required class="mt-1" />
            <span>
              Ik heb de <a href="/privacy" target="_blank" class="text-primary-600 hover:underline">privacyverklaring</a> gelezen en ga akkoord met de verwerking van mijn gegevens.
              <span class="text-red-600">*</span>
            </span>
          </label>
          <p class="text-sm text-red-600 hidden" id="privacy-error">
            U moet akkoord gaan met de privacyverklaring
          </p>

          <label class="flex items-start gap-3 cursor-pointer">
            <input type="checkbox" id="akkoord" required class="mt-1" />
            <span>
              Ik verklaar dat de ingevulde gegevens correct zijn.
              <span class="text-red-600">*</span>
            </span>
          </label>
          <p class="text-sm text-red-600 hidden" id="akkoord-error">
            U moet bevestigen dat de gegevens correct zijn
          </p>
        </div>
      </div>
    </div>

    <!-- Success message -->
    <div id="form-success" class="hidden text-center py-12">
      <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
        <svg class="w-8 h-8 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
        </svg>
      </div>
      <h2 class="text-2xl font-bold text-gray-900 mb-2">Aanvraag verstuurd!</h2>
      <p class="text-gray-700 mb-6">
        Uw herhaalrecept aanvraag is succesvol verstuurd. U ontvangt een bevestiging per e-mail.
      </p>
      <a href="/" class="inline-flex items-center gap-2 px-6 py-3 bg-primary-600 text-white font-medium rounded-lg hover:bg-primary-700 transition-colors">
        Terug naar home
      </a>
    </div>

    <!-- Error message -->
    <div id="form-error" class="hidden bg-red-50 border border-red-200 rounded-lg p-6 text-center">
      <p class="text-red-700 font-medium">
        Er is iets misgegaan bij het versturen. Probeer het opnieuw of neem contact met ons op.
      </p>
    </div>

    <!-- Navigation buttons -->
    <div id="form-navigation" class="flex items-center justify-between pt-6 border-t border-gray-200">
      <button
        type="button"
        id="prev-step"
        class="hidden px-6 py-3 border-2 border-gray-300 text-gray-700 font-medium rounded-lg hover:bg-gray-50 transition-colors"
      >
        Vorige
      </button>

      <button
        type="button"
        id="next-step"
        class="ml-auto px-6 py-3 bg-primary-600 text-white font-medium rounded-lg hover:bg-primary-700 transition-colors"
      >
        Volgende
      </button>

      <button
        type="submit"
        id="submit-form"
        class="hidden ml-auto px-6 py-3 bg-accent text-white font-medium rounded-lg hover:bg-accent-dark transition-colors"
      >
        Aanvragen
      </button>
    </div>

    <!-- Hidden field for Web3Forms -->
    <input type="hidden" name="access_key" value="b66cdc12-96d3-4947-ae81-cec70d966856" />
    <input type="hidden" name="subject" value="Nieuw herhaalrecept aanvraag" />
    <input type="hidden" name="from_name" value="Huisartsenpraktijk Blijham Website" />
  </form>
</div>

<script src="../../scripts/prescription-form.ts"></script>
