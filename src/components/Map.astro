---
import contact from '../data/contact.json';

interface Props {
  height?: string;
}

const { height = '400px' } = Astro.props;
---

<div id="map-container" style={`height: ${height}`} class="rounded-lg border border-gray-200 overflow-hidden">
  <div id="map" class="w-full h-full"></div>
</div>

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />

<script is:inline define:vars={{ lat: contact.coordinates.lat, lng: contact.coordinates.lng, name: contact.name, address: `${contact.address.street}, ${contact.address.postal} ${contact.address.city}` }}>
  // Load Leaflet dynamically
  function initMap() {
    if (typeof L === 'undefined') {
      // Leaflet not loaded yet, try again
      setTimeout(initMap, 100);
      return;
    }

    const map = L.map('map').setView([lat, lng], 16);

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
    }).addTo(map);

    const marker = L.marker([lat, lng]).addTo(map);

    marker.bindPopup(`
      <strong>${name}</strong><br>
      ${address}
    `).openPopup();
  }

  // Load Leaflet script
  const script = document.createElement('script');
  script.src = 'https://unpkg.com/leaflet@1.9.4/dist/leaflet.js';
  script.integrity = 'sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=';
  script.crossOrigin = '';
  script.onload = initMap;
  document.head.appendChild(script);
</script>
